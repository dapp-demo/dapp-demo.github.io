"use strict";(self.webpackChunkimtoken_dapp=self.webpackChunkimtoken_dapp||[]).push([[7013],{75361:(t,e,r)=>{r.d(e,{H2:()=>L,Zk:()=>Y});var i=r(64353),n=r(57727),o=r(2593),s=r(93286),l=r(57218),a=r(84706),c=r(79861),h=r(53587),u=r(23951),d=r(44242),m=r(58341),f=r(92882),g=r.n(f),k=r(80711),p=r(34216),v=r(30032),b=function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function l(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,l)}a((i=i.apply(t,e||[])).next())}))};const _=new k.Yd(p.i);function y(t){return null==t?"null":(32!==(0,s.E1)(t)&&_.throwArgumentError("invalid topic","topic",t),t.toLowerCase())}function N(t){for(t=t.slice();t.length>0&&null==t[t.length-1];)t.pop();return t.map((t=>{if(Array.isArray(t)){const e={};t.forEach((t=>{e[y(t)]=!0}));const r=Object.keys(e);return r.sort(),r.join("|")}return y(t)})).join("&")}function w(t){if("string"==typeof t){if(t=t.toLowerCase(),32===(0,s.E1)(t))return"tx:"+t;if(-1===t.indexOf(":"))return t}else{if(Array.isArray(t))return"filter:*:"+N(t);if(i.Sg.isForkEvent(t))throw _.warn("not implemented"),new Error("not implemented");if(t&&"object"==typeof t)return"filter:"+(t.address||"*")+":"+N(t.topics||[])}throw new Error("invalid event - "+t)}function E(){return(new Date).getTime()}function T(t){return new Promise((e=>{setTimeout(e,t)}))}const B=["block","network","pending","poll"];class R{constructor(t,e,r){(0,h.zG)(this,"tag",t),(0,h.zG)(this,"listener",e),(0,h.zG)(this,"once",r)}get event(){switch(this.type){case"tx":return this.hash;case"filter":return this.filter}return this.tag}get type(){return this.tag.split(":")[0]}get hash(){const t=this.tag.split(":");return"tx"!==t[0]?null:t[1]}get filter(){const t=this.tag.split(":");if("filter"!==t[0])return null;const e=t[1],r=""===(i=t[2])?[]:i.split(/&/g).map((t=>{if(""===t)return[];const e=t.split("|").map((t=>"null"===t?null:t));return 1===e.length?e[0]:e}));var i;const n={};return r.length>0&&(n.topics=r),e&&"*"!==e&&(n.address=e),n}pollable(){return this.tag.indexOf(":")>=0||B.indexOf(this.tag)>=0}}const O={0:{symbol:"btc",p2pkh:0,p2sh:5,prefix:"bc"},2:{symbol:"ltc",p2pkh:48,p2sh:50,prefix:"ltc"},3:{symbol:"doge",p2pkh:30,p2sh:22},60:{symbol:"eth",ilk:"eth"},61:{symbol:"etc",ilk:"eth"},700:{symbol:"xdai",ilk:"eth"}};function P(t){return(0,s.$m)(o.O$.from(t).toHexString(),32)}function x(t){return n.eU.encode((0,s.zo)([t,(0,s.p3)((0,u.JQ)((0,u.JQ)(t)),0,4)]))}const A=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),new RegExp("^(ipfs)://(.*)$","i"),new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];function I(t){try{return(0,d.ZN)($(t))}catch(t){}return null}function $(t){if("0x"===t)return null;const e=o.O$.from((0,s.p3)(t,0,32)).toNumber(),r=o.O$.from((0,s.p3)(t,e,e+32)).toNumber();return(0,s.p3)(t,e+32,e+32+r)}class L{constructor(t,e,r,i){(0,h.zG)(this,"provider",t),(0,h.zG)(this,"name",r),(0,h.zG)(this,"address",t.formatter.address(e)),(0,h.zG)(this,"_resolvedAddress",i)}_fetchBytes(t,e){return b(this,void 0,void 0,(function*(){const r={to:this.address,data:(0,s.xs)([t,(0,a.V)(this.name),e||"0x"])};try{return $(yield this.provider.call(r))}catch(t){return t.code,k.Yd.errors.CALL_EXCEPTION,null}}))}_getAddress(t,e){const r=O[String(t)];if(null==r&&_.throwError(`unsupported coin type: ${t}`,k.Yd.errors.UNSUPPORTED_OPERATION,{operation:`getAddress(${t})`}),"eth"===r.ilk)return this.provider.formatter.address(e);const i=(0,s.lE)(e);if(null!=r.p2pkh){const t=e.match(/^0x76a9([0-9a-f][0-9a-f])([0-9a-f]*)88ac$/);if(t){const e=parseInt(t[1],16);if(t[2].length===2*e&&e>=1&&e<=75)return x((0,s.zo)([[r.p2pkh],"0x"+t[2]]))}}if(null!=r.p2sh){const t=e.match(/^0xa9([0-9a-f][0-9a-f])([0-9a-f]*)87$/);if(t){const e=parseInt(t[1],16);if(t[2].length===2*e&&e>=1&&e<=75)return x((0,s.zo)([[r.p2sh],"0x"+t[2]]))}}if(null!=r.prefix){const t=i[1];let e=i[0];if(0===e?20!==t&&32!==t&&(e=-1):e=-1,e>=0&&i.length===2+t&&t>=1&&t<=75){const t=g().toWords(i.slice(2));return t.unshift(e),g().encode(r.prefix,t)}}return null}getAddress(t){return b(this,void 0,void 0,(function*(){if(null==t&&(t=60),60===t)try{const t={to:this.address,data:"0x3b3b57de"+(0,a.V)(this.name).substring(2)},e=yield this.provider.call(t);return"0x"===e||e===l.R?null:this.provider.formatter.callAddress(e)}catch(t){if(t.code===k.Yd.errors.CALL_EXCEPTION)return null;throw t}const e=yield this._fetchBytes("0xf1cb7e06",P(t));if(null==e||"0x"===e)return null;const r=this._getAddress(t,e);return null==r&&_.throwError("invalid or unsupported coin data",k.Yd.errors.UNSUPPORTED_OPERATION,{operation:`getAddress(${t})`,coinType:t,data:e}),r}))}getAvatar(){return b(this,void 0,void 0,(function*(){const t=[];try{const e=yield this.getText("avatar");if(null==e)return null;for(let r=0;r<A.length;r++){const i=e.match(A[r]);if(null!=i)switch(i[1]){case"https":return t.push({type:"url",content:e}),{linkage:t,url:e};case"data":return t.push({type:"data",content:e}),{linkage:t,url:e};case"ipfs":return t.push({type:"ipfs",content:e}),{linkage:t,url:`https://gateway.ipfs.io/ipfs/${e.substring(7)}`};case"erc721":case"erc1155":{const r="erc721"===i[1]?"0xc87b56dd":"0x0e89341c";t.push({type:i[1],content:e});const n=this._resolvedAddress||(yield this.getAddress()),l=(i[2]||"").split("/");if(2!==l.length)return null;const a=yield this.provider.formatter.address(l[0]),c=(0,s.$m)(o.O$.from(l[1]).toHexString(),32);if("erc721"===i[1]){const e=this.provider.formatter.callAddress(yield this.provider.call({to:a,data:(0,s.xs)(["0x6352211e",c])}));if(n!==e)return null;t.push({type:"owner",content:e})}else if("erc1155"===i[1]){const e=o.O$.from(yield this.provider.call({to:a,data:(0,s.xs)(["0x00fdd58e",(0,s.$m)(n,32),c])}));if(e.isZero())return null;t.push({type:"balance",content:e.toString()})}const h={to:this.provider.formatter.address(l[0]),data:(0,s.xs)([r,c])};let u=I(yield this.provider.call(h));if(null==u)return null;t.push({type:"metadata-url",content:u}),"erc1155"===i[1]&&(u=u.replace("{id}",c.substring(2)));const d=yield(0,m.rd)(u);return d&&"string"==typeof d.image&&d.image.match(/^https:\/\//i)?(t.push({type:"metadata",content:JSON.stringify(d)}),t.push({type:"url",content:d.image}),{linkage:t,url:d.image}):null}}}}catch(t){}return null}))}getContentHash(){return b(this,void 0,void 0,(function*(){const t=yield this._fetchBytes("0xbc1c58d1");if(null==t||"0x"===t)return null;const e=t.match(/^0xe3010170(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(e){const t=parseInt(e[3],16);if(e[4].length===2*t)return"ipfs://"+n.eU.encode("0x"+e[1])}const r=t.match(/^0xe40101fa011b20([0-9a-f]*)$/);return r&&64===r[1].length?"bzz://"+r[1]:_.throwError("invalid or unsupported content hash data",k.Yd.errors.UNSUPPORTED_OPERATION,{operation:"getContentHash()",data:t})}))}getText(t){return b(this,void 0,void 0,(function*(){let e=(0,d.Y0)(t);e=(0,s.zo)([P(64),P(e.length),e]),e.length%32!=0&&(e=(0,s.zo)([e,(0,s.$m)("0x",32-t.length%32)]));const r=yield this._fetchBytes("0x59d1d43c",(0,s.Dv)(e));return null==r||"0x"===r?null:(0,d.ZN)(r)}))}}let S=null,C=1;class Y extends i.zt{constructor(t){if(_.checkNew(new.target,i.zt),super(),this._events=[],this._emitted={block:-2},this.formatter=new.target.getFormatter(),(0,h.zG)(this,"anyNetwork","any"===t),this.anyNetwork&&(t=this.detectNetwork()),t instanceof Promise)this._networkPromise=t,t.catch((t=>{})),this._ready().catch((t=>{}));else{const e=(0,h.tu)(new.target,"getNetwork")(t);e?((0,h.zG)(this,"_network",e),this.emit("network",e,null)):_.throwArgumentError("invalid network","network",t)}this._maxInternalBlockNumber=-1024,this._lastBlockNumber=-2,this._pollingInterval=4e3,this._fastQueryDate=0}_ready(){return b(this,void 0,void 0,(function*(){if(null==this._network){let t=null;if(this._networkPromise)try{t=yield this._networkPromise}catch(t){}null==t&&(t=yield this.detectNetwork()),t||_.throwError("no network detected",k.Yd.errors.UNKNOWN_ERROR,{}),null==this._network&&(this.anyNetwork?this._network=t:(0,h.zG)(this,"_network",t),this.emit("network",t,null))}return this._network}))}get ready(){return(0,m.$l)((()=>this._ready().then((t=>t),(t=>{if(t.code!==k.Yd.errors.NETWORK_ERROR||"noNetwork"!==t.event)throw t}))))}static getFormatter(){return null==S&&(S=new v.Mb),S}static getNetwork(t){return(0,c.H)(null==t?"homestead":t)}_getInternalBlockNumber(t){return b(this,void 0,void 0,(function*(){if(yield this._ready(),t>0)for(;this._internalBlockNumber;){const e=this._internalBlockNumber;try{const r=yield e;if(E()-r.respTime<=t)return r.blockNumber;break}catch(t){if(this._internalBlockNumber===e)break}}const e=E(),r=(0,h.mE)({blockNumber:this.perform("getBlockNumber",{}),networkError:this.getNetwork().then((t=>null),(t=>t))}).then((({blockNumber:t,networkError:i})=>{if(i)throw this._internalBlockNumber===r&&(this._internalBlockNumber=null),i;const n=E();return(t=o.O$.from(t).toNumber())<this._maxInternalBlockNumber&&(t=this._maxInternalBlockNumber),this._maxInternalBlockNumber=t,this._setFastBlockNumber(t),{blockNumber:t,reqTime:e,respTime:n}}));return this._internalBlockNumber=r,r.catch((t=>{this._internalBlockNumber===r&&(this._internalBlockNumber=null)})),(yield r).blockNumber}))}poll(){return b(this,void 0,void 0,(function*(){const t=C++,e=[];let r=null;try{r=yield this._getInternalBlockNumber(100+this.pollingInterval/2)}catch(t){return void this.emit("error",t)}if(this._setFastBlockNumber(r),this.emit("poll",t,r),r!==this._lastBlockNumber){if(-2===this._emitted.block&&(this._emitted.block=r-1),Math.abs(this._emitted.block-r)>1e3)_.warn(`network block skew detected; skipping block events (emitted=${this._emitted.block} blockNumber${r})`),this.emit("error",_.makeError("network block skew detected",k.Yd.errors.NETWORK_ERROR,{blockNumber:r,event:"blockSkew",previousBlockNumber:this._emitted.block})),this.emit("block",r);else for(let t=this._emitted.block+1;t<=r;t++)this.emit("block",t);this._emitted.block!==r&&(this._emitted.block=r,Object.keys(this._emitted).forEach((t=>{if("block"===t)return;const e=this._emitted[t];"pending"!==e&&r-e>12&&delete this._emitted[t]}))),-2===this._lastBlockNumber&&(this._lastBlockNumber=r-1),this._events.forEach((t=>{switch(t.type){case"tx":{const r=t.hash;let i=this.getTransactionReceipt(r).then((t=>t&&null!=t.blockNumber?(this._emitted["t:"+r]=t.blockNumber,this.emit(r,t),null):null)).catch((t=>{this.emit("error",t)}));e.push(i);break}case"filter":{const i=t.filter;i.fromBlock=this._lastBlockNumber+1,i.toBlock=r;const n=this.getLogs(i).then((t=>{0!==t.length&&t.forEach((t=>{this._emitted["b:"+t.blockHash]=t.blockNumber,this._emitted["t:"+t.transactionHash]=t.blockNumber,this.emit(i,t)}))})).catch((t=>{this.emit("error",t)}));e.push(n);break}}})),this._lastBlockNumber=r,Promise.all(e).then((()=>{this.emit("didPoll",t)})).catch((t=>{this.emit("error",t)}))}else this.emit("didPoll",t)}))}resetEventsBlock(t){this._lastBlockNumber=t-1,this.polling&&this.poll()}get network(){return this._network}detectNetwork(){return b(this,void 0,void 0,(function*(){return _.throwError("provider does not support network detection",k.Yd.errors.UNSUPPORTED_OPERATION,{operation:"provider.detectNetwork"})}))}getNetwork(){return b(this,void 0,void 0,(function*(){const t=yield this._ready(),e=yield this.detectNetwork();if(t.chainId!==e.chainId){if(this.anyNetwork)return this._network=e,this._lastBlockNumber=-2,this._fastBlockNumber=null,this._fastBlockNumberPromise=null,this._fastQueryDate=0,this._emitted.block=-2,this._maxInternalBlockNumber=-1024,this._internalBlockNumber=null,this.emit("network",e,t),yield T(0),this._network;const r=_.makeError("underlying network changed",k.Yd.errors.NETWORK_ERROR,{event:"changed",network:t,detectedNetwork:e});throw this.emit("error",r),r}return t}))}get blockNumber(){return this._getInternalBlockNumber(100+this.pollingInterval/2).then((t=>{this._setFastBlockNumber(t)}),(t=>{})),null!=this._fastBlockNumber?this._fastBlockNumber:-1}get polling(){return null!=this._poller}set polling(t){t&&!this._poller?(this._poller=setInterval((()=>{this.poll()}),this.pollingInterval),this._bootstrapPoll||(this._bootstrapPoll=setTimeout((()=>{this.poll(),this._bootstrapPoll=setTimeout((()=>{this._poller||this.poll(),this._bootstrapPoll=null}),this.pollingInterval)}),0))):!t&&this._poller&&(clearInterval(this._poller),this._poller=null)}get pollingInterval(){return this._pollingInterval}set pollingInterval(t){if("number"!=typeof t||t<=0||parseInt(String(t))!=t)throw new Error("invalid polling interval");this._pollingInterval=t,this._poller&&(clearInterval(this._poller),this._poller=setInterval((()=>{this.poll()}),this._pollingInterval))}_getFastBlockNumber(){const t=E();return t-this._fastQueryDate>2*this._pollingInterval&&(this._fastQueryDate=t,this._fastBlockNumberPromise=this.getBlockNumber().then((t=>((null==this._fastBlockNumber||t>this._fastBlockNumber)&&(this._fastBlockNumber=t),this._fastBlockNumber)))),this._fastBlockNumberPromise}_setFastBlockNumber(t){null!=this._fastBlockNumber&&t<this._fastBlockNumber||(this._fastQueryDate=E(),(null==this._fastBlockNumber||t>this._fastBlockNumber)&&(this._fastBlockNumber=t,this._fastBlockNumberPromise=Promise.resolve(t)))}waitForTransaction(t,e,r){return b(this,void 0,void 0,(function*(){return this._waitForTransaction(t,null==e?1:e,r||0,null)}))}_waitForTransaction(t,e,r,i){return b(this,void 0,void 0,(function*(){const n=yield this.getTransactionReceipt(t);return(n?n.confirmations:0)>=e?n:new Promise(((n,o)=>{const s=[];let l=!1;const a=function(){return!!l||(l=!0,s.forEach((t=>{t()})),!1)},c=t=>{t.confirmations<e||a()||n(t)};if(this.on(t,c),s.push((()=>{this.removeListener(t,c)})),i){let r=i.startBlock,n=null;const c=s=>b(this,void 0,void 0,(function*(){l||(yield T(1e3),this.getTransactionCount(i.from).then((h=>b(this,void 0,void 0,(function*(){if(!l){if(h<=i.nonce)r=s;else{{const e=yield this.getTransaction(t);if(e&&null!=e.blockNumber)return}for(null==n&&(n=r-3,n<i.startBlock&&(n=i.startBlock));n<=s;){if(l)return;const r=yield this.getBlockWithTransactions(n);for(let n=0;n<r.transactions.length;n++){const s=r.transactions[n];if(s.hash===t)return;if(s.from===i.from&&s.nonce===i.nonce){if(l)return;const r=yield this.waitForTransaction(s.hash,e);if(a())return;let n="replaced";return s.data===i.data&&s.to===i.to&&s.value.eq(i.value)?n="repriced":"0x"===s.data&&s.from===s.to&&s.value.isZero()&&(n="cancelled"),void o(_.makeError("transaction was replaced",k.Yd.errors.TRANSACTION_REPLACED,{cancelled:"replaced"===n||"cancelled"===n,reason:n,replacement:this._wrapTransaction(s),hash:t,receipt:r}))}}n++}}l||this.once("block",c)}}))),(t=>{l||this.once("block",c)})))}));if(l)return;this.once("block",c),s.push((()=>{this.removeListener("block",c)}))}if("number"==typeof r&&r>0){const t=setTimeout((()=>{a()||o(_.makeError("timeout exceeded",k.Yd.errors.TIMEOUT,{timeout:r}))}),r);t.unref&&t.unref(),s.push((()=>{clearTimeout(t)}))}}))}))}getBlockNumber(){return b(this,void 0,void 0,(function*(){return this._getInternalBlockNumber(0)}))}getGasPrice(){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const t=yield this.perform("getGasPrice",{});try{return o.O$.from(t)}catch(e){return _.throwError("bad result from backend",k.Yd.errors.SERVER_ERROR,{method:"getGasPrice",result:t,error:e})}}))}getBalance(t,e){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const r=yield(0,h.mE)({address:this._getAddress(t),blockTag:this._getBlockTag(e)}),i=yield this.perform("getBalance",r);try{return o.O$.from(i)}catch(t){return _.throwError("bad result from backend",k.Yd.errors.SERVER_ERROR,{method:"getBalance",params:r,result:i,error:t})}}))}getTransactionCount(t,e){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const r=yield(0,h.mE)({address:this._getAddress(t),blockTag:this._getBlockTag(e)}),i=yield this.perform("getTransactionCount",r);try{return o.O$.from(i).toNumber()}catch(t){return _.throwError("bad result from backend",k.Yd.errors.SERVER_ERROR,{method:"getTransactionCount",params:r,result:i,error:t})}}))}getCode(t,e){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const r=yield(0,h.mE)({address:this._getAddress(t),blockTag:this._getBlockTag(e)}),i=yield this.perform("getCode",r);try{return(0,s.Dv)(i)}catch(t){return _.throwError("bad result from backend",k.Yd.errors.SERVER_ERROR,{method:"getCode",params:r,result:i,error:t})}}))}getStorageAt(t,e,r){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const i=yield(0,h.mE)({address:this._getAddress(t),blockTag:this._getBlockTag(r),position:Promise.resolve(e).then((t=>(0,s.$P)(t)))}),n=yield this.perform("getStorageAt",i);try{return(0,s.Dv)(n)}catch(t){return _.throwError("bad result from backend",k.Yd.errors.SERVER_ERROR,{method:"getStorageAt",params:i,result:n,error:t})}}))}_wrapTransaction(t,e,r){if(null!=e&&32!==(0,s.E1)(e))throw new Error("invalid response - sendTransaction");const i=t;return null!=e&&t.hash!==e&&_.throwError("Transaction hash mismatch from Provider.sendTransaction.",k.Yd.errors.UNKNOWN_ERROR,{expectedHash:t.hash,returnedHash:e}),i.wait=(e,i)=>b(this,void 0,void 0,(function*(){let n;null==e&&(e=1),null==i&&(i=0),0!==e&&null!=r&&(n={data:t.data,from:t.from,nonce:t.nonce,to:t.to,value:t.value,startBlock:r});const o=yield this._waitForTransaction(t.hash,e,i,n);return null==o&&0===e?null:(this._emitted["t:"+t.hash]=o.blockNumber,0===o.status&&_.throwError("transaction failed",k.Yd.errors.CALL_EXCEPTION,{transactionHash:t.hash,transaction:t,receipt:o}),o)})),i}sendTransaction(t){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const e=yield Promise.resolve(t).then((t=>(0,s.Dv)(t))),r=this.formatter.transaction(t);null==r.confirmations&&(r.confirmations=0);const i=yield this._getInternalBlockNumber(100+2*this.pollingInterval);try{const t=yield this.perform("sendTransaction",{signedTransaction:e});return this._wrapTransaction(r,t,i)}catch(t){throw t.transaction=r,t.transactionHash=r.hash,t}}))}_getTransactionRequest(t){return b(this,void 0,void 0,(function*(){const e=yield t,r={};return["from","to"].forEach((t=>{null!=e[t]&&(r[t]=Promise.resolve(e[t]).then((t=>t?this._getAddress(t):null)))})),["gasLimit","gasPrice","maxFeePerGas","maxPriorityFeePerGas","value"].forEach((t=>{null!=e[t]&&(r[t]=Promise.resolve(e[t]).then((t=>t?o.O$.from(t):null)))})),["type"].forEach((t=>{null!=e[t]&&(r[t]=Promise.resolve(e[t]).then((t=>null!=t?t:null)))})),e.accessList&&(r.accessList=this.formatter.accessList(e.accessList)),["data"].forEach((t=>{null!=e[t]&&(r[t]=Promise.resolve(e[t]).then((t=>t?(0,s.Dv)(t):null)))})),this.formatter.transactionRequest(yield(0,h.mE)(r))}))}_getFilter(t){return b(this,void 0,void 0,(function*(){t=yield t;const e={};return null!=t.address&&(e.address=this._getAddress(t.address)),["blockHash","topics"].forEach((r=>{null!=t[r]&&(e[r]=t[r])})),["fromBlock","toBlock"].forEach((r=>{null!=t[r]&&(e[r]=this._getBlockTag(t[r]))})),this.formatter.filter(yield(0,h.mE)(e))}))}call(t,e){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const r=yield(0,h.mE)({transaction:this._getTransactionRequest(t),blockTag:this._getBlockTag(e)}),i=yield this.perform("call",r);try{return(0,s.Dv)(i)}catch(t){return _.throwError("bad result from backend",k.Yd.errors.SERVER_ERROR,{method:"call",params:r,result:i,error:t})}}))}estimateGas(t){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const e=yield(0,h.mE)({transaction:this._getTransactionRequest(t)}),r=yield this.perform("estimateGas",e);try{return o.O$.from(r)}catch(t){return _.throwError("bad result from backend",k.Yd.errors.SERVER_ERROR,{method:"estimateGas",params:e,result:r,error:t})}}))}_getAddress(t){return b(this,void 0,void 0,(function*(){"string"!=typeof(t=yield t)&&_.throwArgumentError("invalid address or ENS name","name",t);const e=yield this.resolveName(t);return null==e&&_.throwError("ENS name not configured",k.Yd.errors.UNSUPPORTED_OPERATION,{operation:`resolveName(${JSON.stringify(t)})`}),e}))}_getBlock(t,e){return b(this,void 0,void 0,(function*(){yield this.getNetwork(),t=yield t;let r=-128;const i={includeTransactions:!!e};if((0,s.A7)(t,32))i.blockHash=t;else try{i.blockTag=yield this._getBlockTag(t),(0,s.A7)(i.blockTag)&&(r=parseInt(i.blockTag.substring(2),16))}catch(e){_.throwArgumentError("invalid block hash or block tag","blockHashOrBlockTag",t)}return(0,m.$l)((()=>b(this,void 0,void 0,(function*(){const t=yield this.perform("getBlock",i);if(null==t)return null!=i.blockHash&&null==this._emitted["b:"+i.blockHash]||null!=i.blockTag&&r>this._emitted.block?null:void 0;if(e){let e=null;for(let r=0;r<t.transactions.length;r++){const i=t.transactions[r];if(null==i.blockNumber)i.confirmations=0;else if(null==i.confirmations){null==e&&(e=yield this._getInternalBlockNumber(100+2*this.pollingInterval));let t=e-i.blockNumber+1;t<=0&&(t=1),i.confirmations=t}}const r=this.formatter.blockWithTransactions(t);return r.transactions=r.transactions.map((t=>this._wrapTransaction(t))),r}return this.formatter.block(t)}))),{oncePoll:this})}))}getBlock(t){return this._getBlock(t,!1)}getBlockWithTransactions(t){return this._getBlock(t,!0)}getTransaction(t){return b(this,void 0,void 0,(function*(){yield this.getNetwork(),t=yield t;const e={transactionHash:this.formatter.hash(t,!0)};return(0,m.$l)((()=>b(this,void 0,void 0,(function*(){const r=yield this.perform("getTransaction",e);if(null==r)return null==this._emitted["t:"+t]?null:void 0;const i=this.formatter.transactionResponse(r);if(null==i.blockNumber)i.confirmations=0;else if(null==i.confirmations){let t=(yield this._getInternalBlockNumber(100+2*this.pollingInterval))-i.blockNumber+1;t<=0&&(t=1),i.confirmations=t}return this._wrapTransaction(i)}))),{oncePoll:this})}))}getTransactionReceipt(t){return b(this,void 0,void 0,(function*(){yield this.getNetwork(),t=yield t;const e={transactionHash:this.formatter.hash(t,!0)};return(0,m.$l)((()=>b(this,void 0,void 0,(function*(){const r=yield this.perform("getTransactionReceipt",e);if(null==r)return null==this._emitted["t:"+t]?null:void 0;if(null==r.blockHash)return;const i=this.formatter.receipt(r);if(null==i.blockNumber)i.confirmations=0;else if(null==i.confirmations){let t=(yield this._getInternalBlockNumber(100+2*this.pollingInterval))-i.blockNumber+1;t<=0&&(t=1),i.confirmations=t}return i}))),{oncePoll:this})}))}getLogs(t){return b(this,void 0,void 0,(function*(){yield this.getNetwork();const e=yield(0,h.mE)({filter:this._getFilter(t)}),r=yield this.perform("getLogs",e);return r.forEach((t=>{null==t.removed&&(t.removed=!1)})),v.Mb.arrayOf(this.formatter.filterLog.bind(this.formatter))(r)}))}getEtherPrice(){return b(this,void 0,void 0,(function*(){return yield this.getNetwork(),this.perform("getEtherPrice",{})}))}_getBlockTag(t){return b(this,void 0,void 0,(function*(){if("number"==typeof(t=yield t)&&t<0){t%1&&_.throwArgumentError("invalid BlockTag","blockTag",t);let e=yield this._getInternalBlockNumber(100+2*this.pollingInterval);return e+=t,e<0&&(e=0),this.formatter.blockTag(e)}return this.formatter.blockTag(t)}))}getResolver(t){return b(this,void 0,void 0,(function*(){try{const e=yield this._getResolver(t);return null==e?null:new L(this,e,t)}catch(t){return t.code,k.Yd.errors.CALL_EXCEPTION,null}}))}_getResolver(t){return b(this,void 0,void 0,(function*(){const e=yield this.getNetwork();e.ensAddress||_.throwError("network does not support ENS",k.Yd.errors.UNSUPPORTED_OPERATION,{operation:"ENS",network:e.name});const r={to:e.ensAddress,data:"0x0178b8bf"+(0,a.V)(t).substring(2)};try{return this.formatter.callAddress(yield this.call(r))}catch(t){if(t.code===k.Yd.errors.CALL_EXCEPTION)return null;throw t}}))}resolveName(t){return b(this,void 0,void 0,(function*(){t=yield t;try{return Promise.resolve(this.formatter.address(t))}catch(e){if((0,s.A7)(t))throw e}"string"!=typeof t&&_.throwArgumentError("invalid ENS name","name",t);const e=yield this.getResolver(t);return e?yield e.getAddress():null}))}lookupAddress(t){return b(this,void 0,void 0,(function*(){t=yield t;const e=(t=this.formatter.address(t)).substring(2).toLowerCase()+".addr.reverse",r=yield this._getResolver(e);if(!r)return null;let i=(0,s.lE)(yield this.call({to:r,data:"0x691f3431"+(0,a.V)(e).substring(2)}));if(i.length<32||!o.O$.from(i.slice(0,32)).eq(32))return null;if(i=i.slice(32),i.length<32)return null;const n=o.O$.from(i.slice(0,32)).toNumber();if(i=i.slice(32),n>i.length)return null;const l=(0,d.ZN)(i.slice(0,n));return(yield this.resolveName(l))!=t?null:l}))}getAvatar(t){return b(this,void 0,void 0,(function*(){let e=null;if((0,s.A7)(t)){const r=this.formatter.address(t),i=r.substring(2).toLowerCase()+".addr.reverse",n=yield this._getResolver(i);if(!n)return null;e=new L(this,n,"_",r)}else e=yield this.getResolver(t);const r=yield e.getAvatar();return null==r?null:r.url}))}perform(t,e){return _.throwError(t+" not implemented",k.Yd.errors.NOT_IMPLEMENTED,{operation:t})}_startEvent(t){this.polling=this._events.filter((t=>t.pollable())).length>0}_stopEvent(t){this.polling=this._events.filter((t=>t.pollable())).length>0}_addEventListener(t,e,r){const i=new R(w(t),e,r);return this._events.push(i),this._startEvent(i),this}on(t,e){return this._addEventListener(t,e,!1)}once(t,e){return this._addEventListener(t,e,!0)}emit(t,...e){let r=!1,i=[],n=w(t);return this._events=this._events.filter((t=>t.tag!==n||(setTimeout((()=>{t.listener.apply(this,e)}),0),r=!0,!t.once||(i.push(t),!1)))),i.forEach((t=>{this._stopEvent(t)})),r}listenerCount(t){if(!t)return this._events.length;let e=w(t);return this._events.filter((t=>t.tag===e)).length}listeners(t){if(null==t)return this._events.map((t=>t.listener));let e=w(t);return this._events.filter((t=>t.tag===e)).map((t=>t.listener))}off(t,e){if(null==e)return this.removeAllListeners(t);const r=[];let i=!1,n=w(t);return this._events=this._events.filter((t=>t.tag!==n||t.listener!=e||(!!i||(i=!0,r.push(t),!1)))),r.forEach((t=>{this._stopEvent(t)})),this}removeAllListeners(t){let e=[];if(null==t)e=this._events,this._events=[];else{const r=w(t);this._events=this._events.filter((t=>t.tag!==r||(e.push(t),!1)))}return e.forEach((t=>{this._stopEvent(t)})),this}}}}]);